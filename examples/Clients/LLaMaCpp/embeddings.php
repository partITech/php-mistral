<?php
require_once __DIR__ . '/../../../vendor/autoload.php';

use Partitech\PhpMistral\Clients\LlamaCpp\LlamaCppClient;
use Partitech\PhpMistral\Embeddings\EmbeddingCollection;

$llamacppUrl = getenv('LLAMACPP_EMBEDDING_URL');
$llamacppApiKey = getenv('LLAMACPP_API_KEY');

$client = new LlamaCppClient(apiKey: $llamacppApiKey, url: $llamacppUrl);

$inputs = [];

for($i=0; $i<10; $i++) {
    $inputs[] = "$i : What is the best French cheese?";
}

//$result = $client->embedText(text: 'test');
//$test = $result;


//$result = $client->embedTexts(texts: $inputs, model:null, batch: 3);
//$test = $result;
//
//
$embeddingCollection = (new EmbeddingCollection())
    ->fromList($inputs)
    ->setBatchSize(3);
$result = $client->createEmbeddings($embeddingCollection);
$test = $result;

//try {
//    $embeddingsBatchResponse = $client->embeddings($inputs);
//} catch (MistralClientException $e) {
//    echo $e->getMessage();
//    exit(1);
//}
//
//print_r($embeddingsBatchResponse);


/*
Array
(
    [model] => gpt-3.5-turbo
    [object] => list
    [usage] => Array
        (
            [prompt_tokens] => 9
            [total_tokens] => 9
        )

    [data] => Array
        (
            [0] => Array
                (
                    [embedding] => Array
                        (
                            [0] => 0.026056783273816
                            [1] => -0.052360784262419
                            [2] => -0.052065674215555
                            [3] => -0.00016634898202028
                            [4] => -0.0036687001120299
                            [5] => -0.032379955053329
                            [6] => 0.0050138430669904
                            [7] => 0.042958907783031
                            [8] => 0.023931253701448
                            [9] => 0.0048192879185081
                            [10] => -0.026064187288284
                            [11] => -0.033234275877476
                            [12] => 0.065229661762714
                            [13] => -0.1014022603631
                            [14] => -0.057968232780695
                            [15] => 0.012864337302744
                            [16] => -0.015046404674649
                            [17] => -0.019676653668284
                            [18] => -0.043712850660086
                            [19] => 0.033390700817108
                            [20] => -0.090512774884701
                            [21] => -0.029664095491171
                            [22] => 0.033164117485285
                            [23] => 0.018212189897895
                            [24] => 0.08880876749754
                            [25] => -0.097416721284389
                            [26] => 0.049079582095146
                            [27] => 0.056081186980009
                            [28] => 0.057667065411806
                            [29] => 0.080450035631657
                            [30] => -0.037371296435595
                            [31] => -0.0086284521967173
                            [32] => -0.049754105508327
                            [33] => 0.032285712659359
                            [34] => -0.013680437579751
                            [35] => 0.0086838379502296
                            [36] => 0.029545528814197
                            [37] => 0.017881236970425
                            [38] => -0.00021873174409848
                            [39] => 0.0090064825490117
                            [40] => -0.045249573886395
                            [41] => -0.0090141361579299
                            [42] => 0.065293446183205
                            [43] => -0.026560563594103
                            [44] => 0.02732639759779
                            [45] => -0.022073533385992
                            [46] => 0.050033934414387
                            [47] => 0.030985347926617
                            [48] => -0.020661517977715
                            [49] => 0.077861540019512
                            [50] => 0.061634361743927
                            [51] => 0.01713222451508
                            [52] => 0.025402192026377
                            [53] => 0.039823237806559
                            [54] => -0.035670109093189
                            [55] => -0.065199300646782
                            [56] => -0.027290282770991
                            [57] => -0.041238192468882
                            [58] => -0.08877520263195
                            [59] => -0.033758625388145
                            [60] => 0.014914900064468
                            [61] => -0.01385628990829
                            [62] => 0.00088091392535716
                            [63] => 0.02238486520946
                            [64] => -0.026221925392747
                            [65] => 0.012764897197485
                            [66] => -0.012737985700369
                            [67] => 0.054486736655235
                            [68] => -0.013763627968729
                            [69] => 0.078694500029087
                            [70] => 0.027050916105509
                            [71] => 0.047060318291187
                            [72] => -0.00069942243862897
                            [73] => 0.010693562217057
                            [74] => -0.070342041552067
                            [75] => 0.067226208746433
                            [76] => -0.024995794519782
                            [77] => 0.031295698136091
                            [78] => 0.038288101553917
                            [79] => -0.079956248402596
                            [80] => 0.0017677682917565
                            [81] => -0.044983811676502
                            [82] => 0.015773493796587
                            [83] => 0.011420011520386
                            [84] => 0.029571773484349
                            [85] => 0.01247404422611
                            [86] => 0.050033163279295
                            [87] => 0.078300133347511
                            [88] => -0.063231192529202
                            [89] => 0.045926228165627
                            [90] => -0.016818655654788
                            [91] => -0.028326326981187
                            [92] => -0.035134524106979
                            [93] => 0.10209009051323
                            [94] => -0.036114927381277
                            [95] => 0.036520346999168
                            [96] => 0.026891039684415
                            [97] => 0.055139198899269
                            [98] => 0.17398434877396
                            [99] => -0.017883194610476
                            [100] => -0.065725013613701
                            [101] => 0.0048086629249156
                            [102] => -0.060964699834585
                            [103] => 0.032835815101862
                            [104] => -0.033544905483723
                            [105] => -0.029438257217407
                            [106] => 0.040917366743088
                            [107] => 0.055112432688475
                            [108] => -0.033901080489159
                            [109] => -0.032652523368597
                            [110] => -0.029811143875122
                            [111] => 0.13437965512276
                            [112] => -0.1395561248064
                            [113] => -0.04460384324193
                            [114] => 0.0028638809453696
                            [115] => 0.072069175541401
                            [116] => -0.077704131603241
                            [117] => 0.036424208432436
                            [118] => -0.035787660628557
                            [119] => -0.064032286405563
                            [120] => -0.043390933424234
                            [121] => -0.084260448813438
                            [122] => -0.026197651401162
                            [123] => -0.021121537312865
                            [124] => 0.041999217122793
                            [125] => -0.035872891545296
                            [126] => -0.051455292850733
                            [127] => -0.013913595117629
                            [128] => 0.024662707000971
                            [129] => -0.038104768842459
                            [130] => -0.023271311074495
                            [131] => -0.098238602280617
                            [132] => 0.072012774646282
                            [133] => 0.046602539718151
                            [134] => -0.013782645575702
                            [135] => -0.017745351418853
                            [136] => -0.032459259033203
                            [137] => 0.038984730839729
                            [138] => 0.042135164141655
                            [139] => -0.036851968616247
                            [140] => 0.0264892000705
                            [141] => 0.051208846271038
                            [142] => 0.017824782058597
                            [143] => 0.013897128403187
                            [144] => 0.047498535364866
                            [145] => -0.044758599251509
                            [146] => -0.021891627460718
                            [147] => 0.076674625277519
                            [148] => -0.026800062507391
                            [149] => 0.040380254387856
                            [150] => 0.00084424804663286
                            [151] => -0.10515727847815
                            [152] => 0.0373590067029
                            [153] => 0.0029266744386405
                            [154] => -0.11529745161533
                            [155] => -0.034668151289225
                            [156] => -0.11075180023909
                            [157] => 0.048554357141256
                            [158] => -0.018916066735983
                            [159] => 0.030239898711443
                            [160] => -0.024029387161136
                            [161] => 0.010084359906614
                            [162] => 0.35577300190926
                            [163] => -0.12474657595158
                            [164] => -0.096019454300404
                            [165] => -0.035047136247158
                            [166] => 0.022690512239933
                            [167] => 0.062411773949862
                            [168] => -0.022024651989341
                            [169] => -0.021405052393675
                            [170] => 0.073929406702518
                            [171] => 0.020245153456926
                            [172] => -0.033443000167608
                            [173] => 0.043262783437967
                            [174] => 0.068314753472805
                            [175] => 0.01385139580816
                            [176] => 0.054256699979305
                            [177] => 0.054268918931484
                            [178] => -0.036453556269407
                            [179] => 0.05963059514761
                            [180] => -0.01600500009954
                            [181] => 0.0091717420145869
                            [182] => 0.020861951634288
                            [183] => -0.050070110708475
                            [184] => 0.032336205244064
                            [185] => 0.0042697000317276
                            [186] => -0.013076831586659
                            [187] => -0.090827517211437
                            [188] => 0.04041513428092
                            [189] => -0.033309023827314
                            [190] => -0.00072523788549006
                            [191] => -0.034261330962181
                            [192] => -0.023249447345734
                            [193] => -0.0035751503892243
                            [194] => 0.0033237480092794
                            [195] => 0.025525098666549
                            [196] => -0.044784978032112
                            [197] => -0.033278573304415
                            [198] => 0.0082666110247374
                            [199] => -0.051001708954573
                            [200] => -0.010044354945421
                            [201] => 0.0063788867555559
                            [202] => 0.052524983882904
                            [203] => -0.034793615341187
                            [204] => -0.029385378584266
                            [205] => -0.039028033614159
                            [206] => 0.038631167262793
                            [207] => -0.045637477189302
                            [208] => 0.021387172862887
                            [209] => -0.087053380906582
                            [210] => -0.077347002923489
                            [211] => 0.0063881454989314
                            [212] => 0.031199580058455
                            [213] => 0.0039483094587922
                            [214] => -0.028694609180093
                            [215] => -0.064986132085323
                            [216] => 0.043336056172848
                            [217] => -0.017285402864218
                            [218] => -0.01170767750591
                            [219] => -0.071579910814762
                            [220] => 0.04140405729413
                            [221] => -0.045996945351362
                            [222] => -0.023795176297426
                            [223] => -0.02750444971025
                            [224] => 0.014242058619857
                            [225] => -0.022211635485291
                            [226] => 0.059579465538263
                            [227] => 0.035795327275991
                            [228] => 0.020981024950743
                            [229] => -0.087499514222145
                            [230] => 0.0074497289024293
                            [231] => 0.029561834409833
                            [232] => 0.0089049767702818
                            [233] => -0.048899974673986
                            [234] => 0.011524512432516
                            [235] => -0.072881504893303
                            [236] => 0.016071289777756
                            [237] => -0.038889449089766
                            [238] => 0.01525214035064
                            [239] => -0.074478551745415
                            [240] => 0.011565126478672
                            [241] => 0.00043840490980074
                            [242] => 0.053239271044731
                            [243] => 0.052751068025827
                            [244] => 0.0010342145105824
                            [245] => 0.060246523469687
                            [246] => -0.018014656379819
                            [247] => 0.0026703695766628
                            [248] => -0.0095217460766435
                            [249] => -0.11706237494946
                            [250] => -0.048607919365168
                            [251] => 0.012982215732336
                            [252] => 0.050563406199217
                            [253] => -0.09218792617321
                            [254] => -0.047278542071581
                            [255] => -0.0076680886559188
                            [256] => 0.010196277871728
                            [257] => -0.056440301239491
                            [258] => 0.048616018146276
                            [259] => -0.027541553601623
                            [260] => 0.026042696088552
                            [261] => -0.04653212428093
                            [262] => -0.042092561721802
                            [263] => -0.034738332033157
                            [264] => 0.021756008267403
                            [265] => 0.052897218614817
                            [266] => 0.0061691021546721
                            [267] => -0.036969792097807
                            [268] => 0.041850637644529
                            [269] => -0.04743305966258
                            [270] => -0.0035787730012089
                            [271] => -0.0012615978484973
                            [272] => 0.08077722042799
                            [273] => -0.042663373053074
                            [274] => 0.0011232743272558
                            [275] => 0.043863471597433
                            [276] => -0.017265558242798
                            [277] => 0.03869241476059
                            [278] => 0.073379062116146
                            [279] => -0.044273212552071
                            [280] => 0.0088333627209067
                            [281] => -0.097697153687477
                            [282] => 0.082032583653927
                            [283] => -0.010708849877119
                            [284] => -0.0048562148585916
                            [285] => -0.017109552398324
                            [286] => -0.0014657292049378
                            [287] => -0.082065016031265
                            [288] => 0.007491884753108
                            [289] => -0.011257194913924
                            [290] => -0.027220770716667
                            [291] => 0.020825689658523
                            [292] => 0.022246582433581
                            [293] => 0.020394127815962
                            [294] => 0.020736595615745
                            [295] => 0.094926044344902
                            [296] => -0.088363297283649
                            [297] => -0.071893401443958
                            [298] => -0.0047038332559168
                            [299] => -0.041926428675652
                            [300] => 0.011362850666046
                            [301] => -0.011327370069921
                            [302] => -0.0098062343895435
                            [303] => -0.050572235137224
                            [304] => 0.058462787419558
                            [305] => 0.056140098720789
                            [306] => -0.017591014504433
                            [307] => 0.008460289798677
                            [308] => -0.034859105944633
                            [309] => -0.028127642348409
                            [310] => -0.031302656978369
                            [311] => -0.063323996961117
                            [312] => 0.0074398731812835
                            [313] => -0.046635821461678
                            [314] => -0.017103394493461
                            [315] => 0.00021992609254085
                            [316] => 0.15463310480118
                            [317] => -0.040781389921904
                            [318] => -0.0029072533361614
                            [319] => -0.048778235912323
                            [320] => -0.0047048795968294
                            [321] => 0.13075713813305
                            [322] => -0.08695362508297
                            [323] => -0.0050267106853426
                            [324] => 0.03644934669137
                            [325] => 0.041419684886932
                            [326] => -0.066758945584297
                            [327] => -0.0059681814163923
                            [328] => 0.019897349178791
                            [329] => -0.043520823121071
                            [330] => 0.057489667087793
                            [331] => -0.021119607612491
                            [332] => -0.026307361200452
                            [333] => 0.022650768980384
                            [334] => 0.024726189672947
                            [335] => -0.0026906616985798
                            [336] => 0.13080374896526
                            [337] => -0.005997056607157
                            [338] => 0.025912387296557
                            [339] => -0.060861952602863
                            [340] => -0.07671557366848
                            [341] => 0.004488701466471
                            [342] => -0.024683929979801
                            [343] => -0.035211451351643
                            [344] => 0.043076686561108
                            [345] => 0.05829070135951
                            [346] => -0.039247788488865
                            [347] => 0.013756978325546
                            [348] => -0.0030967015773058
                            [349] => -0.014190553687513
                            [350] => -0.0017735975561664
                            [351] => 0.017377123236656
                            [352] => -0.01981845125556
                            [353] => 0.065532743930817
                            [354] => 0.058499306440353
                            [355] => -0.038946457207203
                            [356] => 0.0015871418872848
                            [357] => -0.078187562525272
                            [358] => -0.0068043088540435
                            [359] => 0.019239095970988
                            [360] => 0.010745757259429
                            [361] => 0.0019868314266205
                            [362] => -0.0042818342335522
                            [363] => -0.018264215439558
                            [364] => 0.020314700901508
                            [365] => -0.02887661755085
                            [366] => -0.056508220732212
                            [367] => -0.02615725249052
                            [368] => 0.032390639185905
                            [369] => 0.032528348267078
                            [370] => -0.017689330503345
                            [371] => 0.020814374089241
                            [372] => 0.043838679790497
                            [373] => 0.055451761931181
                            [374] => 0.091901987791061
                            [375] => -0.033600308001041
                            [376] => 0.0051642945036292
                            [377] => -0.0062779556028545
                            [378] => -0.016047604382038
                            [379] => -0.074385248124599
                            [380] => 0.098954074084759
                            [381] => -0.049553081393242
                            [382] => -0.010787117294967
                            [383] => 0.074204355478287
                        )

                    [index] => 0
                    [object] => embedding
                )

        )

)
*/
